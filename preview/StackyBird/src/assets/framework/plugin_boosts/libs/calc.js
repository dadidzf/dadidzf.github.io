var chars={"+":{type:"Operator",value:"+",asso:"left",prec:2},"-":{type:"Operator",value:"-",asso:"left",prec:2},"*":{type:"Operator",value:"*",asso:"left",prec:3},"/":{type:"Operator",value:"/",asso:"left",prec:3},"^":{type:"Operator",value:"^",asso:"right",prec:4},number:function(e){if(!isNaN(e)&&isFinite(e))return{type:"Literal",value:e+""}},"(":{type:"Left Parenthesis",value:"("},")":{type:"Right Parenthesis",value:")"}};function tokenize(e){e=e.replace(/(\t|\s)/g,"");for(var t=[],r="",a=0;a<e.length;a++)p(e.charAt(a))?(r+=e.charAt(a),p(e.charAt(a+1))||(t.push(chars.number(r)),r="")):n(e.charAt(a))?"-"==e.charAt(a)&&(""==e.charAt(a-1)||n(e.charAt(a-1))||"("==e.charAt(a-1))&&p(e.charAt(a+1))?r+="-":t.push(chars[e.charAt(a)]):h(e.charAt(a),["(",")"])&&("("==e.charAt(a)?((p(e.charAt(a-1))||")"==e.charAt(a-1))&&t.push(chars["*"]),t.push(chars["("])):t.push(chars[")"]));function h(e,t){for(var r=0;r<t.length;r++)if(e===t[r])return!0;return!1}function p(e){return h(e,["0","1","2","3","4","5","6","7","8","9","."])}function n(e){return h(e,["+","-","*","/","^"])}return t}function c(e){for(var t=[],r=[],a=0;a<e.length;a++){var h=e[a],p=!!r.length&&r[r.length-1];if("Literal"==h.type)t.push(h);else if("Operator"==h.type){for(;p&&"("!=p.value&&(h.prec<p.prec||"left"==h.asso&&h.prec==p.prec);)t.push(r.pop()),p=!!r.length&&r[r.length];r.push(h)}else if("Left Parenthesis"==h.type)r.push(h);else if("Right Parenthesis"==h.type){for(;p&&"("!=p.value;)t.push(r.pop()),p=!!r.length&&r[r.length-1];r.pop()}}return t.concat(r.reverse())}function t(e){for(var t=[],r=0;r<e.length;r++)if("Literal"==e[r].type)t.push(parseFloat(e[r].value));else if("Operator"==e[r].type)switch(e[r].value){case"+":t[t.length-2]=parseFloat((1e4*t[t.length-2]+1e4*t[t.length-1])/1e4),t.pop();break;case"-":t[t.length-2]=parseFloat((1e4*t[t.length-2]-1e4*t[t.length-1])/1e4),t.pop();break;case"*":t[t.length-2]=parseFloat(t[t.length-2]*t[t.length-1]),t.pop();break;case"/":t[t.length-2]=parseFloat(t[t.length-2]/t[t.length-1]),t.pop();break;case"^":t[t.length-2]=parseFloat(Math.pow(t[t.length-2],t[t.length-1])),t.pop()}return t.length?t[0]:0}function calc(e){return t(c(tokenize(e))).toString()}window.calc=calc;